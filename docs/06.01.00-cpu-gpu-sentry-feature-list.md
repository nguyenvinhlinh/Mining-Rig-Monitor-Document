# CPU/GPU Sentry Feature List

- Fetching newer mining playbooks from `Commander` regularly.
- Setup mining software as new mining playbook comining in.
- Start mining automatically.
- Send machine specs to `Commander`
- Send mining operational log to `Commander`
- Allow `Commander` to remotely
    - Stop mining
    - Start mining
    - Shutdown machine
    - Restart machine

## Câu hỏi ‌/ kịch bản

- ngay khi khởi động app, chúng ta cho chạy EventStash với event {:fetch_mining_playbook} luôn.

Sau đó, EventDispatcher pop message đầu tiên ra khỏi EventStash


- [Time_1]Sau khi fetch xong playbook list lần [1], chúng ta sẽ có
    - xmrig v1 + tham số
    - bzminer v1 + tham số

- Ở trong MiningManager, Khởi tạo event trong EventStash, put/1

  - [event 1] download + load module xmrig v1
  - [event 3] chạy phần mềm xmrig v1 + tham số   nếu giá trị expected_status = `mining`
  - [event 2] download + load module bzminer v1
  - [event 4] chạy phần mềm bzminer v1 + tham số nếu giá trị expected_status = `mining`
  - [event 5] tạo event MiningManager kéo lại danh sách mining playbook.
  - [event 6] tạo event MiningManager, kéo danh sách os_event (shutdown/restart) (làm sau, ko quan trọng)

   Ở thời điểm này, MiningManager dừng execute, done

- Dispatcher có thể dễ dàng phân vai/việc cho các event 1-5.
- Tuy nhiên, bây h khi load playbook list. sẽ có rất nhiều trường hợp liên quan đến playbook đã tồn tại và mới.

**case 1:** playbook list mới empty, array trống

- tạo event tắt tất cả ứng đụng đào coin đang tồn tại
- tạo event fetch lại danh sách playbook sau 30s

**case 2**: playbook list mới không empty,

- lay danh sach playbook đang có trong Playbook Stash, cái nào không nằm ID trong danh sách mới
- tạo event stop playbook cũ
- tạo event xóa playbook cũ


for loop, từng playbook mới fetch về từ api GET /cpu_gpu_miner/playbooks,

lúc này có 2 trường hợp nữa xảy ra:

- đã có tồn tại, lại có 2 trường hợp con xảy ra
    - cái đã tồn tại có timestamp cũ hơn cái mới - TH_A
    - cái đã tồn tại không có khác so với cái mới - TH_B

- chưa có tồn tại - TH_C

TH A và C, sẽ giải quyết như sau

- tạo event tắt playbook cũ
- tạo event download + load module
- tạo event chạy playbook nếu mà giá trị expected_status = `mining`.
